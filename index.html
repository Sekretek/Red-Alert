
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Red Alert Rocket Tracker</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.112/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.112/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      z-index: 1;
    }
  </style>
</head>
<body>
<div id="cesiumContainer"></div>
<div id="controls">
  <label for="targetSelect">Выберите город:</label>
  <select id="targetSelect"></select>
  <button onclick="launchRocket()">Запуск</button>
</div>
<script>
  const viewer = new Cesium.Viewer('cesiumContainer', {
    terrainProvider: Cesium.createWorldTerrain(),
    imageryProvider: new Cesium.IonImageryProvider({ assetId: 2 }),
    shouldAnimate: true
  });

  let citiesGeoDataSource;

  // Загрузка GeoJSON с границами городов
  Cesium.GeoJsonDataSource.load('Borders.json', {
    stroke: Cesium.Color.BLACK,
    fill: Cesium.Color.GRAY.withAlpha(0.2),
    strokeWidth: 1
  }).then((dataSource) => {
    viewer.dataSources.add(dataSource);
    citiesGeoDataSource = dataSource;
    updateCityList(dataSource.entities.values);
  });

  function updateCityList(entities) {
    const select = document.getElementById('targetSelect');
    select.innerHTML = '';
    entities.forEach(entity => {
      const name = entity.properties['שם_ישוב']?.getValue();
      if (name) {
        const option = document.createElement('option');
        option.value = entity.id;
        option.textContent = name;
        select.appendChild(option);
      }
    });
  }

  function launchRocket() {
    const select = document.getElementById('targetSelect');
    const selectedId = select.value;
    if (!selectedId || !citiesGeoDataSource) return;

    const targetEntity = citiesGeoDataSource.entities.getById(selectedId);
    if (!targetEntity) return;

    // Подсветка цели
    citiesGeoDataSource.entities.values.forEach(e => {
      if (e.polygon) {
        e.polygon.material = Cesium.Color.GRAY.withAlpha(0.2);
        e.polygon.outlineColor = Cesium.Color.BLACK;
      }
    });

    targetEntity.polygon.material = Cesium.Color.RED.withAlpha(0.4);
    targetEntity.polygon.outlineColor = Cesium.Color.RED;

    // Центрируем камеру на цель
    viewer.flyTo(targetEntity);
  }
</script>
</body>
</html>
